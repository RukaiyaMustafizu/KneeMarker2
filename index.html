<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KneeMarker Pro - Advanced Osteoarthritis Detection</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <style>
      :root {
        --primary-color: #166088;
        --secondary-color: #4a6fa5;
        --accent-color: #4fc3f7;
        --light-color: #f8f9fa;
        --dark-color: #212529;
        --medical-blue: #0077b6;
        --medical-teal: #00b4d8;
        --success-green: #2e8b57;
        --warning-orange: #ff8c00;
        --danger-red: #d62828;
      }

      @font-face {
        font-family: "Montserrat";
        src: url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap");
      }

      body {
        font-family: "Montserrat", "Segoe UI", Tahoma, Geneva, Verdana,
          sans-serif;
        background-color: #f5f9fc;
        background-image: linear-gradient(
            to bottom,
            rgba(245, 249, 252, 0.9),
            rgba(245, 249, 252, 0.9)
          ),
          url("https://images.unsplash.com/photo-1579684385127-1ef15d508118?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        color: #333;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: "Montserrat", sans-serif;
        font-weight: 600;
        color: var(--primary-color);
      }

      h1 {
        font-weight: 700;
        font-size: 2.5rem;
        color: var(--primary-color);
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        position: relative;
        display: inline-block;
      }

      h1:after {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 0;
        width: 80px;
        height: 4px;
        background: var(--accent-color);
        border-radius: 2px;
      }

      /* Main container */
      .test-container {
        max-width: 900px;
        margin: 3rem auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        padding: 2.5rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }

      .test-container:before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 8px;
        height: 100%;
        background: linear-gradient(
          to bottom,
          var(--primary-color),
          var(--accent-color)
        );
      }

      /* Info section */
      .info-section {
        background-color: #f8fafc;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
      }

      .info-section h3 {
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
      }

      .info-section h3 i {
        margin-right: 12px;
        color: var(--accent-color);
      }

      /* Language toggle */
      .language-toggle {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        z-index: 1000;
        background: white;
        border-radius: 8px;
        padding: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
      }

      .language-toggle select {
        border: none;
        background: transparent;
        font-weight: 500;
      }

      /* AI Assistant Button */
      #ai-assistant-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        color: white;
        border: none;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 1050;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(22, 96, 136, 0.7);
        }
        70% {
          box-shadow: 0 0 0 15px rgba(22, 96, 136, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(22, 96, 136, 0);
        }
      }

      #ai-assistant-btn:hover {
        transform: scale(1.1) rotate(5deg);
        animation: none;
      }

      #ai-assistant-btn .badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background: var(--danger-red);
        color: white;
        font-size: 0.7rem;
        padding: 5px 8px;
        border-radius: 20px;
      }

      /* AI Chat Container */
      #ai-assistant-container {
        position: fixed;
        bottom: 9rem;
        right: 2rem;
        width: 400px;
        max-width: 90vw;
        height: 600px;
        max-height: 80vh;
        background: white;
        border-radius: 16px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        display: none;
        flex-direction: column;
        z-index: 1050;
        overflow: hidden;
        transform-origin: bottom right;
        animation: fadeIn 0.3s ease-out;
        border: 1px solid rgba(0, 0, 0, 0.1);
        cursor: move;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* Chat header */
      .ai-chat-header {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 1.2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        cursor: move;
      }

      .ai-chat-header h5 {
        margin: 0;
        font-weight: 600;
        display: flex;
        align-items: center;
      }

      .ai-chat-header h5 i {
        margin-right: 10px;
      }

      .ai-close-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .ai-close-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
      }

      /* Chat body */
      .ai-chat-body {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
        background: #f9fbfd;
      }

      /* Message styles */
      .message {
        margin-bottom: 1.2rem;
        max-width: 85%;
        animation: messageIn 0.3s ease-out;
        position: relative;
      }

      @keyframes messageIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-message {
        margin-left: auto;
        background: var(--primary-color);
        color: white;
        border-radius: 18px 18px 4px 18px;
        padding: 0.9rem 1.2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .assistant-message {
        margin-right: auto;
        background: white;
        color: var(--dark-color);
        border-radius: 18px 18px 18px 4px;
        padding: 0.9rem 1.2rem;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .assistant-message:before {
        content: "";
        position: absolute;
        left: -8px;
        top: 0;
        width: 0;
        height: 0;
        border: 10px solid transparent;
        border-right-color: white;
        border-left: 0;
      }

      .user-message:before {
        content: "";
        position: absolute;
        right: -8px;
        top: 0;
        width: 0;
        height: 0;
        border: 10px solid transparent;
        border-left-color: var(--primary-color);
        border-right: 0;
      }

      .thinking-message {
        color: #666;
        font-style: italic;
        text-align: center;
        padding: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .thinking-dots {
        display: inline-flex;
        align-items: center;
        margin-left: 8px;
      }

      .thinking-dots span {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #999;
        margin: 0 2px;
        animation: bounce 1.4s infinite ease-in-out;
      }

      .thinking-dots span:nth-child(1) {
        animation-delay: -0.32s;
      }

      .thinking-dots span:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
      }

      /* Chat input area */
      .ai-chat-input {
        display: flex;
        padding: 1.2rem;
        background: white;
        border-top: 1px solid #eee;
        flex-direction: column;
      }

      .ai-chat-input input {
        flex: 1;
        border: 1px solid #ddd;
        border-radius: 24px;
        padding: 0.7rem 1.2rem;
        outline: none;
        transition: all 0.2s;
        font-size: 0.95rem;
        margin-bottom: 0.8rem;
      }

      .ai-chat-input input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
      }

      .ai-send-btn {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        margin-left: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .ai-send-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* File upload in AI chat */
      .ai-file-upload {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        background: #f5f9ff;
        border-radius: 8px;
        margin-bottom: 0.8rem;
      }

      .ai-file-upload label {
        margin: 0;
        font-size: 0.9rem;
        color: var(--primary-color);
        cursor: pointer;
      }

      .ai-file-upload input {
        display: none;
      }

      .ai-file-upload .file-info {
        font-size: 0.8rem;
        color: #666;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 70%;
      }

      /* Quick action buttons */
      .quick-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        margin-top: 1.2rem;
      }

      .quick-action-btn {
        background: #e9f2fa;
        border: none;
        border-radius: 20px;
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--primary-color);
        border: 1px solid rgba(22, 96, 136, 0.2);
      }

      .quick-action-btn:hover {
        background: #d6e6f7;
        transform: translateY(-2px);
      }

      /* Video container */
      .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        background: #000;
      }

      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      /* Analyze button */
      #analyzeBtn {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 12px;
        padding: 1rem;
        font-size: 1.1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(22, 96, 136, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 1.5rem 0;
      }

      #analyzeBtn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(22, 96, 136, 0.4);
      }

      #analyzeBtn i {
        margin-right: 10px;
      }

      /* Test strip upload area */
      .upload-area {
        border: 2px dashed #ddd;
        border-radius: 12px;
        padding: 2.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 1.5rem;
        position: relative;
        background: #f9fbfd;
      }

      .upload-area:hover {
        border-color: var(--accent-color);
        background: rgba(79, 195, 247, 0.05);
        transform: translateY(-2px);
      }

      .upload-area i {
        transition: all 0.3s;
      }

      .upload-area:hover i {
        transform: translateY(-5px);
      }

      .clear-upload {
        position: absolute;
        top: 0.8rem;
        right: 0.8rem;
        background: rgba(0, 0, 0, 0.1);
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .clear-upload:hover {
        background: rgba(0, 0, 0, 0.2);
        transform: rotate(90deg);
      }

      /* Test result display */
      .test-result {
        margin-top: 1.5rem;
        text-align: center;
      }

      .test-result-image {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        max-height: 250px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      /* Video section */
      .video-section {
        text-align: center;
        margin-top: 3rem;
        padding: 1.5rem;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .video-section h5 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .video-section h5 i {
        margin-right: 10px;
        color: var(--accent-color);
      }

      /* Biomarker info cards */
      .biomarker-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
      }

      .biomarker-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .biomarker-card h4 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
      }

      .biomarker-card h4 i {
        margin-right: 10px;
        color: var(--accent-color);
      }

      .biomarker-card .card-icon {
        font-size: 2rem;
        color: var(--accent-color);
        margin-bottom: 1rem;
      }

      .biomarker-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        font-size: 0.9rem;
      }

      .biomarker-table th,
      .biomarker-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .biomarker-table th {
        background-color: #f8fafc;
        color: var(--primary-color);
        font-weight: 500;
      }

      .biomarker-table tr:last-child td {
        border-bottom: none;
      }

      /* Progress tracker */
      .progress-tracker {
        display: flex;
        justify-content: space-between;
        margin: 2rem 0;
        position: relative;
      }

      .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
      }

      .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #666;
        margin-bottom: 0.5rem;
        border: 3px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .step-number.active {
        background: var(--primary-color);
        color: white;
      }

      .step-number.completed {
        background: var(--success-green);
        color: white;
      }

      .step-label {
        font-size: 0.8rem;
        font-weight: 500;
        color: #666;
        text-align: center;
      }

      .step-label.active {
        color: var(--primary-color);
        font-weight: 600;
      }

      .progress-line {
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 4px;
        background: #e9ecef;
        z-index: 1;
      }

      .progress-fill {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--accent-color)
        );
        border-radius: 2px;
        transition: width 0.3s ease;
      }

      /* Instruction Manual Section */
      .manual-section {
        margin-top: 3rem;
        background: #f8fafc;
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .manual-step {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px dashed #ddd;
      }

      .manual-step:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .step-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
      }

      .step-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        flex-shrink: 0;
      }

      .step-title {
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 0;
      }

      .step-content {
        padding-left: 55px;
      }

      .step-image {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .manual-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
      }

      .manual-item {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .manual-item i {
        color: var(--accent-color);
        margin-right: 8px;
      }

      /* Progress Tracker Tab */
      .progress-tracker-tab {
        margin-top: 3rem;
        background: #f8fafc;
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .progress-tracker-tab h3 {
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .progress-tracker-tab h3 i {
        margin-right: 10px;
        color: var(--accent-color);
      }

      .tracker-form {
        margin-bottom: 2rem;
      }

      .tracker-results {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .tracker-table {
        width: 100%;
        border-collapse: collapse;
      }

      .tracker-table th,
      .tracker-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .tracker-table th {
        background-color: #f8fafc;
        color: var(--primary-color);
        font-weight: 500;
      }

      .tracker-table tr:last-child td {
        border-bottom: none;
      }

      .tracker-graph {
        margin-top: 2rem;
        height: 250px;
        background: white;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        position: relative;
      }

      .graph-line {
        position: absolute;
        bottom: 50px;
        left: 50px;
        right: 50px;
        height: 2px;
        background: #eee;
      }

      .graph-point {
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--primary-color);
        transform: translate(-6px, -6px);
      }

      .graph-label {
        position: absolute;
        font-size: 0.8rem;
        color: #666;
      }

      .graph-legend {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
        gap: 1.5rem;
      }

      .legend-item {
        display: flex;
        align-items: center;
        font-size: 0.8rem;
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 6px;
      }

      /* Scientific diagram styling */
      .scientific-diagram {
        width: 100%;
        max-width: 600px;
        margin: 1.5rem auto;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      /* References section */
      .references {
        font-size: 0.8rem;
        color: #666;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #eee;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 1.5rem;
        color: #666;
        font-size: 0.9rem;
        margin-top: 3rem;
      }

      /* Animation classes */
      .fade-in {
        animation: fadeIn 0.5s ease-out;
      }

      .slide-up {
        animation: slideUp 0.5s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Tooltip styling */
      .tooltip-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--accent-color);
        color: white;
        font-size: 0.7rem;
        margin-left: 5px;
        cursor: help;
        position: relative;
      }

      .tooltip-text {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: var(--dark-color);
        color: white;
        padding: 0.5rem;
        border-radius: 6px;
        font-size: 0.8rem;
        width: 200px;
        margin-bottom: 10px;
        visibility: hidden;
        opacity: 0;
        transition: all 0.2s;
        z-index: 100;
      }

      .tooltip-icon:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }

      /* Toggle switch for manual */
      .manual-toggle {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
      }

      .toggle-btn {
        padding: 0.75rem 1.5rem;
        background: #f0f0f0;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
      }

      .toggle-btn:first-child {
        border-radius: 8px 0 0 8px;
      }

      .toggle-btn:last-child {
        border-radius: 0 8px 8px 0;
      }

      .toggle-btn.active {
        background: var(--primary-color);
        color: white;
      }

      /* Save Results Section */
      .save-results {
        margin-top: 2rem;
        background: #f8fafc;
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .save-results h4 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .save-results h4 i {
        margin-right: 10px;
        color: var(--accent-color);
      }

      .save-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .test-container {
          margin: 1rem;
          padding: 1.5rem;
          border-radius: 12px;
        }

        #ai-assistant-container {
          width: 90vw;
          right: 5vw;
          height: 70vh;
        }

        .progress-tracker {
          flex-wrap: wrap;
          gap: 1rem;
        }

        .progress-step {
          flex: 1 0 60px;
        }

        .progress-line {
          display: none;
        }

        .upload-area {
          padding: 1.5rem;
        }

        .step-content {
          padding-left: 0;
        }

        .manual-grid {
          grid-template-columns: 1fr;
        }

        .save-actions {
          flex-direction: column;
          align-items: center;
        }

        .tracker-form .row > div {
          margin-bottom: 1rem;
        }

        .ai-chat-input {
          padding: 1rem;
        }
      }

      /* iPhone 15 specific adjustments */
      @media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
        .test-container {
          margin: 0.5rem;
          padding: 1rem;
        }

        h1 {
          font-size: 2rem;
        }

        .info-section,
        .manual-section,
        .progress-tracker-tab {
          padding: 1rem;
        }

        .biomarker-card {
          padding: 1rem;
        }

        .ai-chat-input {
          padding: 0.8rem;
        }

        #ai-assistant-container {
          height: 60vh;
          bottom: 8rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Language Toggle -->
    <div class="language-toggle">
      <i class="fas fa-globe me-2" style="color: var(--primary-color)"></i>
      <select
        id="languageSelector"
        class="form-select form-select-sm border-0"
        style="width: auto"
      >
        <option value="en">English</option>
        <option value="nl">Dutch</option>
      </select>
    </div>

    <!-- Main Content Container -->
    <div class="container-fluid">
      <!-- Main Test Container -->
      <div class="test-container p-4" data-aos="fade-up">
        <div class="text-center mb-4">
          <img
            src="kneemarker-icon.jpg"
            alt="KneeMarker Logo"
            class="mb-3"
            style="max-height: 60px"
          />
          <h1 data-lang="title">KneeMarker Early OA Detection System</h1>
          <p class="lead" data-lang="subtitle">
            Revolutionizing Post-ACL Osteoarthritis Monitoring
          </p>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
          <div class="progress-line">
            <div class="progress-fill" style="width: 33%"></div>
          </div>
          <div class="progress-step">
            <div class="step-number completed">1</div>
            <div class="step-label" data-lang="step-1">Upload Test</div>
          </div>
          <div class="progress-step">
            <div class="step-number active">2</div>
            <div class="step-label" data-lang="step-2">Analyze</div>
          </div>
          <div class="progress-step">
            <div class="step-number">3</div>
            <div class="step-label" data-lang="step-3">Results</div>
          </div>
        </div>

        <!-- Information Section -->
        <div class="info-section" data-aos="fade-up" data-aos-delay="100">
          <h3>
            <i class="fas fa-microscope me-2"></i>
            <span data-lang="about-test">About the KneeMarker Test</span>
          </h3>
          <p data-lang="test-description">
            The KneeMarker test is an innovative point-of-care lateral flow
            immunoassay (LFIA) designed for early detection of post-traumatic
            osteoarthritis (PTOA) in ACL-reconstructed patients. Our test
            measures three key biomarkers:
          </p>

          <div class="row mt-3">
            <div class="col-md-4" data-aos="fade-up" data-aos-delay="150">
              <div class="biomarker-card">
                <div class="card-icon">
                  <i class="fas fa-dna"></i>
                </div>
                <h4>CTX-II</h4>
                <p data-lang="ctx-description">
                  C-telopeptide of type II collagen - a specific marker for
                  cartilage degradation
                </p>
              </div>
            </div>
            <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
              <div class="biomarker-card">
                <div class="card-icon">
                  <i class="fas fa-project-diagram"></i>
                </div>
                <h4>COMP</h4>
                <p data-lang="comp-description">
                  Cartilage Oligomeric Matrix Protein - indicates cartilage
                  turnover and structural integrity
                </p>
              </div>
            </div>
            <div class="col-md-4" data-aos="fade-up" data-aos-delay="250">
              <div class="biomarker-card">
                <div class="card-icon">
                  <i class="fas fa-virus"></i>
                </div>
                <h4>Anti-CCP</h4>
                <p data-lang="ccp-description">
                  Differentiates osteoarthritis from rheumatoid arthritis with
                  98% specificity
                </p>
              </div>
            </div>
          </div>

          <div class="accordion mt-3" id="infoAccordion">
            <div class="accordion-item border-0 mb-2">
              <h2 class="accordion-header">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#howItWorks"
                  data-lang="how-it-works"
                >
                  <i class="fas fa-cogs me-2"></i> How It Works
                </button>
              </h2>
              <div
                id="howItWorks"
                class="accordion-collapse collapse"
                data-bs-parent="#infoAccordion"
              >
                <div class="accordion-body">
                  <img
                    src="KneeMarker LFIA test mechanism.png"
                    alt="LFIA Mechanism"
                    class="scientific-diagram mb-3"
                  />
                  <p data-lang="how-works-1">
                    The test utilizes gold nanoparticle-conjugated antibodies in
                    a lateral flow immunoassay format. When urine is applied,
                    biomarkers (CTX-II and COMP) bind to specific antibodies,
                    forming visible complexes at test lines. The anti-CCP strip
                    detects rheumatoid arthritis antibodies separately.
                  </p>
                  <p data-lang="how-works-2">
                    Our proprietary algorithm analyzes line intensity to provide
                    semi-quantitative results with 98% clinical accuracy
                    compared to ELISA standards. The test requires no special
                    storage or sample processing.
                  </p>
                </div>
              </div>
            </div>
            <div class="accordion-item border-0 mb-2">
              <h2 class="accordion-header">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#clinicalSignificance"
                  data-lang="clinical-significance"
                >
                  <i class="fas fa-heartbeat me-2"></i> Clinical Significance
                </button>
              </h2>
              <div
                id="clinicalSignificance"
                class="accordion-collapse collapse"
                data-bs-parent="#infoAccordion"
              >
                <div class="accordion-body">
                  <p data-lang="early-detection">
                    Early detection of osteoarthritis enables:
                  </p>
                  <ul class="list-group list-group-flush mb-3">
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check-circle text-success me-2"></i>
                      <span data-lang="therapy"
                        >Timely intervention with physical therapy</span
                      >
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check-circle text-success me-2"></i>
                      <span data-lang="lifestyle"
                        >Lifestyle modifications to slow progression</span
                      >
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check-circle text-success me-2"></i>
                      <span data-lang="trials"
                        >Potential enrollment in clinical trials for new
                        treatments</span
                      >
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check-circle text-success me-2"></i>
                      <span data-lang="surgery"
                        >Better surgical outcomes when addressed early</span
                      >
                    </li>
                  </ul>
                  <p data-lang="clinical-note">
                    Studies show 50% of ACL-reconstructed patients develop PTOA
                    within 12-14 years. Our test detects biochemical changes
                    years before radiographic evidence.
                  </p>
                </div>
              </div>
            </div>
            <div class="accordion-item border-0">
              <h2 class="accordion-header">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#biomarkerDetails"
                  data-lang="biomarker-details"
                >
                  <i class="fas fa-flask me-2"></i> Biomarker Details
                </button>
              </h2>
              <div
                id="biomarkerDetails"
                class="accordion-collapse collapse"
                data-bs-parent="#infoAccordion"
              >
                <div class="accordion-body">
                  <h5>CTX-II Interpretation</h5>
                  <table class="biomarker-table">
                    <thead>
                      <tr>
                        <th data-lang="category">Category</th>
                        <th data-lang="range">Range (ng/mmol Cr)</th>
                        <th data-lang="interpretation">Interpretation</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td data-lang="low">Low</td>
                        <td>4-15</td>
                        <td data-lang="ctx-low">
                          Normal to mildly elevated levels. Likely no OA or
                          early-stage OA.
                        </td>
                      </tr>
                      <tr>
                        <td data-lang="moderate">Moderate</td>
                        <td>16-63</td>
                        <td data-lang="ctx-moderate">
                          Moderately elevated. May indicate cartilage breakdown
                          in progress.
                        </td>
                      </tr>
                      <tr>
                        <td data-lang="high">High</td>
                        <td>64+</td>
                        <td data-lang="ctx-high">
                          Strong indicator of active OA progression or
                          post-traumatic OA.
                        </td>
                      </tr>
                    </tbody>
                  </table>

                  <h5 class="mt-4">COMP Interpretation</h5>
                  <table class="biomarker-table">
                    <thead>
                      <tr>
                        <th data-lang="category">Category</th>
                        <th data-lang="range">Range (ng/ml)</th>
                        <th data-lang="interpretation">Interpretation</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td data-lang="low">Low</td>
                        <td>200-600</td>
                        <td data-lang="comp-low">
                          Within normal variation or mild matrix turnover.
                        </td>
                      </tr>
                      <tr>
                        <td data-lang="moderate">Moderate</td>
                        <td>601-1400</td>
                        <td data-lang="comp-moderate">
                          Elevated; possible active joint remodeling.
                        </td>
                      </tr>
                      <tr>
                        <td data-lang="high">High</td>
                        <td>1401+</td>
                        <td data-lang="comp-high">
                          Significant matrix degradation, indicative of active
                          OA.
                        </td>
                      </tr>
                    </tbody>
                  </table>

                  <h5 class="mt-4">Anti-CCP Interpretation</h5>
                  <table class="biomarker-table">
                    <thead>
                      <tr>
                        <th data-lang="threshold">Threshold</th>
                        <th data-lang="interpretation">Interpretation</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>&lt; 5.0 U/mL</td>
                        <td data-lang="ccp-negative">
                          Negative, rheumatoid arthritis is unlikely
                        </td>
                      </tr>
                      <tr>
                        <td>≥ 5.0 U/mL</td>
                        <td data-lang="ccp-positive">
                          Positive, rheumatoid arthritis is likely (98%
                          specificity)
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <h4 class="text-center mb-4" data-lang="upload-instructions">
          <i class="fas fa-upload me-2"></i> Upload Test Strip for Analysis
        </h4>

        <div class="upload-area" id="uploadArea" data-aos="fade-up">
          <i
            class="fas fa-cloud-upload-alt fa-4x mb-3"
            style="color: var(--primary-color)"
          ></i>
          <h5 data-lang="upload-text">
            Drag & drop your test strip image here
          </h5>
          <p class="text-muted" data-lang="or-text">or click to browse files</p>
          <input type="file" id="fileInput" accept="image/*" class="d-none" />
        </div>

        <button
          id="analyzeBtn"
          class="btn w-100"
          data-lang="analyze"
          data-aos="fade-up"
          data-aos-delay="100"
        >
          <i class="fas fa-search me-2"></i> Analyze Test Strip
        </button>

        <div id="resultContainer" class="mt-4 text-center"></div>

        <!-- Save Results Section -->
        <div class="save-results" id="saveResultsSection" style="display: none">
          <h4>
            <i class="fas fa-save me-2"></i>
            <span data-lang="save-results">Save Your Results</span>
          </h4>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label
                  for="patientNotes"
                  class="form-label"
                  data-lang="treatment-notes"
                  >Treatment Notes</label
                >
                <textarea
                  class="form-control"
                  id="patientNotes"
                  rows="3"
                  placeholder="Enter details about your treatment, symptoms, or progress..."
                ></textarea>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="nextSteps" class="form-label" data-lang="next-steps"
                  >Next Steps</label
                >
                <textarea
                  class="form-control"
                  id="nextSteps"
                  rows="3"
                  placeholder="Enter your planned next steps or recommendations..."
                ></textarea>
              </div>
            </div>
          </div>
          <div class="save-actions">
            <button class="btn btn-primary" id="saveResultsBtn">
              <i class="fas fa-save me-1"></i>
              <span data-lang="save-btn">Save Results</span>
            </button>
            <button class="btn btn-outline-secondary" id="clearResultsBtn">
              <i class="fas fa-trash-alt me-1"></i>
              <span data-lang="clear-btn">Clear</span>
            </button>
          </div>
        </div>

        <!-- Progress Tracker Tab -->
        <div class="progress-tracker-tab" data-aos="fade-up">
          <h3>
            <i class="fas fa-chart-line me-2"></i>
            <span data-lang="progress-tracker">Progress Tracker</span>
          </h3>

          <div class="tracker-form">
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="trackerDate" class="form-label" data-lang="date"
                    >Date</label
                  >
                  <input type="date" class="form-control" id="trackerDate" />
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="trackerCTX" class="form-label"
                    >CTX-II Level</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="trackerCTX"
                    placeholder="Enter CTX-II value"
                  />
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="trackerCOMP" class="form-label">COMP Level</label>
                  <input
                    type="number"
                    class="form-control"
                    id="trackerCOMP"
                    placeholder="Enter COMP value"
                  />
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label for="trackerNotes" class="form-label" data-lang="notes"
                >Notes</label
              >
              <textarea
                class="form-control"
                id="trackerNotes"
                rows="2"
                placeholder="Add any notes about your condition or treatment..."
              ></textarea>
            </div>
            <div class="text-center">
              <button class="btn btn-primary" id="addTrackerBtn">
                <i class="fas fa-plus me-1"></i>
                <span data-lang="add-entry">Add Entry</span>
              </button>
            </div>
          </div>

          <div class="tracker-results">
            <h5 class="text-center mb-3" data-lang="your-progress">
              Your Progress
            </h5>
            <div class="table-responsive">
              <table class="tracker-table">
                <thead>
                  <tr>
                    <th data-lang="date">Date</th>
                    <th>CTX-II</th>
                    <th>COMP</th>
                    <th data-lang="status">Status</th>
                    <th data-lang="actions">Actions</th>
                  </tr>
                </thead>
                <tbody id="trackerTableBody">
                  <!-- Entries will be added here -->
                </tbody>
              </table>
            </div>

            <div class="tracker-graph">
              <div class="graph-line"></div>
              <!-- Graph points will be added here -->
              <div class="graph-legend">
                <div class="legend-item">
                  <span
                    class="legend-color"
                    style="background: var(--primary-color)"
                  ></span>
                  <span>CTX-II</span>
                </div>
                <div class="legend-item">
                  <span
                    class="legend-color"
                    style="background: var(--accent-color)"
                  ></span>
                  <span>COMP</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Instruction Manual Section -->
        <div class="manual-section" data-aos="fade-up">
          <h3 class="text-center mb-4">
            <i class="fas fa-book-open me-2"></i>
            <span data-lang="manual-title">KneeMarker Instruction Manual</span>
          </h3>

          <div class="manual-toggle">
            <button
              class="toggle-btn active"
              id="visualManualBtn"
              data-lang="visual-manual"
            >
              Visual Guide
            </button>
            <button
              class="toggle-btn"
              id="textManualBtn"
              data-lang="text-manual"
            >
              Text Version
            </button>
          </div>

          <div id="visualManual">
            <div class="manual-step">
              <div class="step-header">
                <div class="step-icon">1</div>
                <h4 class="step-title" data-lang="manual-purpose">
                  Purpose of the Test
                </h4>
              </div>
              <div class="step-content">
                <p data-lang="manual-purpose-text">
                  The KneeMarker is a rapid urine test that detects early signs
                  of osteoarthritis (OA) in patients recovering from ACL
                  injuries by measuring biomarkers of cartilage degradation:
                </p>
                <ul>
                  <li data-lang="manual-ctx">
                    CTX-II (C-Telopeptide of type II collagen)
                  </li>
                  <li data-lang="manual-comp">
                    COMP (Cartilage Oligomeric Matrix Protein)
                  </li>
                </ul>
                <p data-lang="manual-purpose-note">
                  These markers show cartilage damage before symptoms appear.
                </p>
                <img
                  src="Osteoarthiritis.png"
                  alt="Purpose Diagram"
                  class="step-image"
                />
              </div>
            </div>
           <div id="visualManual">
            <div class="manual-step">
              <div class="step-header">
                <div class="step-icon">2</div>
                <h4 class="step-title" data-lang="manual-purpose">
                  What's Inside the Box
                </h4>
              </div>

            <div class="manual-step">
              <div class="step-header"></div>
              <div class="step-content">
                <div class="manual-grid">
                  <div class="manual-item">
                    <i class="fas fa-vial"></i>
                    <span data-lang="manual-strip"
                      >1× Lateral Flow Test Strip</span
                    >
                  </div>
                  <div class="manual-item">
                    <i class="fas fa-flask"></i>
                    <span data-lang="manual-cup">1× Urine Collection Cup</span>
                  </div>
                  <div class="manual-item">
                    <i class="fas fa-tint"></i>
                    <span data-lang="manual-dropper"
                      >1× Disposable Dropper</span
                    >
                  </div>
                  <div class="manual-item">
                    <i class="fas fa-book"></i>
                    <span data-lang="manual-manual">1× Instruction Manual</span>
                  </div>
                  <div class="manual-item">
                    <i class="fas fa-qrcode"></i>
                    <span data-lang="manual-qr"
                      >1× QR Code Card (for the KneeMarker App)</span
                    >
                  </div>
                  <div class="manual-item">
                    <i class="fas fa-hands"></i>
                    <span data-lang="manual-gloves"
                      > 1× Disposable Glove Pair</span
                    >
                  </div>
                </div>
                <img
                  src="Instruction Manual.png"
                  alt="Kit Contents"
                  class="step-image"
                />
              </div>
            </div>

            <!-- More manual steps would go here -->
            <!-- I've included 2 steps as an example, but you would add all 11 steps from your manual -->
          </div>

          <div id="textManual" style="display: none">
            <div class="accordion" id="textManualAccordion">
              <!-- Text version of manual would go here -->
              <ul>
                <li>
                  1. Purpose of the Test Why use the KneeMarker? The KneeMarker
                  is a rapid urine test that detects early signs of
                  osteoarthritis (OA) in patients recovering from ACL injuries
                  by measuring biomarkers of cartilage degradation: CTX-II
                  (C-Telopeptide of type II collagen) COMP (Cartilage Oligomeric
                  Matrix Protein) These markers show cartilage damage before
                  symptoms appear.
                </li>
                <li>
                  2. What's Inside the Box
                  <ul>
                    <li>1× Lateral Flow Test Strip</li>
                    <li>1× Urine Collection Cup</li>
                    <li>1× Disposable Dropper</li>
                    <li>1× Instruction Manual</li>
                    <li>1× Glove Pair</li>
                    <li>1× QR Code Card (for the KneeMarker App)</li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Video Section -->
        <div class="video-section" data-aos="fade-up">
          <h5>
            <i class="fas fa-play-circle me-2"></i>
            <span data-lang="video-title">KneeMarker Test Demonstration</span>
          </h5>
          <p data-lang="video-description" class="mb-3">
            See the test in action with our detailed demonstration video
          </p>

          <div class="video-container">
            <iframe
              src="https://www.youtube.com/embed/HTEPBt5i8LM"
              title="KneeMarker Video"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>

          <div class="d-flex justify-content-center mt-3">
            <div class="me-3">
              <i
                class="fas fa-qrcode me-2"
                style="color: var(--primary-color)"
              ></i>
              <span data-lang="scan-text">Scan for more info</span>
            </div>
            <div>
              <i
                class="fas fa-phone-alt me-2"
                style="color: var(--primary-color)"
              ></i>
              <span data-lang="support-text">Support: +31 123 456 789</span>
            </div>
          </div>
        </div>

        <!-- References Section -->
        <div class="references" data-aos="fade-up">
          <h6 data-lang="references-title">Clinical References</h6>
          <ol>
            <li data-lang="ref-1">
              Kraus VB, et al. (2010). Biomarkers for osteoarthritis: current
              position and steps towards further validation. Best Pract Res Clin
              Rheumatol.
            </li>
            <li data-lang="ref-2">
              Whiting PF, et al. (2010). Anti-CCP antibody testing for the
              diagnosis of rheumatoid arthritis. Cochrane Database Syst Rev.
            </li>
            <li data-lang="ref-3">
              Lohmander LS, et al. (2003). The long-term consequence of anterior
              cruciate ligament and meniscus injuries: osteoarthritis. Am J
              Sports Med.
            </li>
          </ol>
        </div>

        <!-- Footer -->
        <div class="footer" data-aos="fade-up">
          <p data-lang="footer-text">
            © 2025 KneeMarker Diagnostics Hogeschoolfontys ABSE minor group 3.
            All rights reserved. For professional use only.
          </p>
          <div class="d-flex justify-content-center">
            <a href="#" class="mx-2 text-decoration-none" data-lang="privacy"
              >Privacy Policy</a
            >
            <a href="#" class="mx-2 text-decoration-none" data-lang="terms"
              >Terms of Use</a
            >
            <a href="#" class="mx-2 text-decoration-none" data-lang="contact"
              >Contact Us</a
            >
          </div>
          <div class="coder">
            This was coded by
            <a
              href="https://www.linkedin.com/in/rukaiya-mustafizu-muhammad-3410772a2/"
              >Rukaiya Mustafizu Muhammad</a
            >
            and open source on
            <a href="https://github.com/RukaiyaMustafizu/KneeMarker2">Github</a>
            & hosted on
            <a href="https://kneemarker.netlify.app"> Netlify</a>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Assistant Floating Button -->
    <button id="ai-assistant-btn" class="btn">
      <i class="fas fa-robot fa-lg"></i>
      <span class="badge">AI</span>
    </button>

    <!-- AI Assistant Chat Container -->
    <div id="ai-assistant-container">
      <div class="ai-chat-header">
        <h5>
          <i class="fas fa-robot me-2"></i>
          <span data-lang="ai-title">KneeMarker Clinical Assistant</span>
        </h5>
        <button class="ai-close-btn" id="ai-close-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="ai-chat-body" id="ai-chat-body">
        <!-- Messages will appear here -->
        <div class="message assistant-message">
          <div class="d-flex align-items-center mb-1">
            <strong data-lang="ai-name">KneeMarker AI</strong>
            <small class="text-muted ms-2">Today</small>
          </div>
          <div data-lang="ai-welcome">
            Hello! I'm your KneeMarker clinical assistant. I can help with:
          </div>
          <ul>
            <li data-lang="ai-help-1">
              Interpreting test results and biomarker levels
            </li>
            <li data-lang="ai-help-2">
              Explaining the LFIA technology behind KneeMarker
            </li>
            <li data-lang="ai-help-3">
              Clinical insights on osteoarthritis progression
            </li>
            <li data-lang="ai-help-4">
              Guidance on patient management protocols
            </li>
            <li data-lang="ai-help-5">Instruction manual guidance</li>
            <li>Analyzing your historical test results</li>
          </ul>
          <div class="mt-2" data-lang="ai-prompt">
            How can I assist you today?
          </div>
        </div>

        <div class="quick-actions mt-3">
          <button
            class="quick-action-btn"
            data-question="Explain the clinical significance of elevated CTX-II levels"
            data-lang="quick-action-1"
          >
            CTX-II Significance
          </button>
          <button
            class="quick-action-btn"
            data-question="How do I properly collect a urine sample for the test?"
            data-lang="quick-action-2"
          >
            Sample Collection
          </button>
          <button
            class="quick-action-btn"
            data-question="What do I do if my test shows invalid results?"
            data-lang="quick-action-3"
          >
            Invalid Results
          </button>
        </div>
      </div>

      <div class="ai-chat-input">
        <div class="ai-file-upload">
          <label for="ai-file-input">
            <i class="fas fa-paperclip me-1"></i>
            <span data-lang="upload-results">Upload Previous Results</span>
          </label>
          <input
            type="file"
            id="ai-file-input"
            accept=".pdf,.jpg,.png,.jpeg"
            class="d-none"
          />
          <div class="file-info" id="ai-file-info"></div>
        </div>
        <input
          type="text"
          id="ai-user-input"
          placeholder="Ask about test interpretation, biomarkers, or clinical protocols..."
          autocomplete="off"
          data-lang="ai-placeholder"
        />
        <div class="d-flex">
          <button class="ai-send-btn" id="ai-send-btn">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AOS Animation Library -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- TensorFlow.js for machine learning -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <!-- Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // SheCodes API Key
      const apiKey = "tf315a00255a026o44c386706557b731";

      // Enhanced Translations with complete Dutch support
      const translations = {
        en: {
          title: "KneeMarker Early OA Detection System",
          subtitle: "Revolutionizing Post-ACL Osteoarthritis Monitoring",
          "about-test": "About the KneeMarker Test",
          "test-description":
            "The KneeMarker test is an innovative point-of-care lateral flow immunoassay (LFIA) designed for early detection of post-traumatic osteoarthritis (PTOA) in ACL-reconstructed patients. Our test measures three key biomarkers:",
          "ctx-description":
            "C-telopeptide of type II collagen - a specific marker for cartilage degradation",
          "comp-description":
            "Cartilage Oligomeric Matrix Protein - indicates cartilage turnover and structural integrity",
          "ccp-description":
            "Differentiates osteoarthritis from rheumatoid arthritis with 98% specificity",
          "test-details":
            "These biomarkers help indicate cartilage breakdown before visible symptoms appear. The test is 98% accurate when used correctly and provides results in just 10 minutes.",
          "how-it-works": "How It Works",
          "how-works-1":
            "The test utilizes gold nanoparticle-conjugated antibodies in a lateral flow immunoassay format. When urine is applied, biomarkers (CTX-II and COMP) bind to specific antibodies, forming visible complexes at test lines. The anti-CCP strip detects rheumatoid arthritis antibodies separately.",
          "how-works-2":
            "Our proprietary algorithm analyzes line intensity to provide semi-quantitative results with 98% clinical accuracy compared to ELISA standards. The test requires no special storage or sample processing.",
          "clinical-significance": "Clinical Significance",
          "biomarker-details": "Biomarker Details",
          "early-detection": "Early detection of osteoarthritis enables:",
          therapy: "Timely intervention with physical therapy",
          lifestyle: "Lifestyle modifications to slow progression",
          trials: "Potential enrollment in clinical trials for new treatments",
          surgery: "Better surgical outcomes when addressed early",
          "clinical-note":
            "Studies show 50% of ACL-reconstructed patients develop PTOA within 12-14 years. Our test detects biochemical changes years before radiographic evidence.",
          "upload-instructions": "Upload Test Strip for Analysis",
          "step-1": "Upload Test",
          "step-2": "Analyze",
          "step-3": "Results",
          intro: "Upload a photo of your test strip to begin analysis.",
          analyze: "Analyze Test Strip",
          analyzing: "Analyzing...",
          result: "Analysis complete! Result: Positive",
          "upload-text": "Drag & drop your test strip image here",
          "or-text": "or click to browse files",
          "positive-result":
            "Positive - Cartilage degradation biomarkers detected",
          "negative-result": "Negative - No biomarkers detected",
          "invalid-result": "Invalid - Please repeat the test",
          "upload-error": "Please upload an image first",
          "video-title": "KneeMarker Test Demonstration",
          "video-description":
            "See the test in action with our detailed demonstration video",
          "scan-text": "Scan for more info",
          "support-text": "Support: +31 123 456 789",
          "video-scan-note":
            "Scan the QR code on your test kit to access this video",
          "ai-title": "KneeMarker Clinical Assistant",
          "ai-name": "KneeMarker AI",
          "ai-welcome":
            "Hello! I'm your KneeMarker clinical assistant. I can help with:",
          "ai-help-1": "Interpreting test results and biomarker levels",
          "ai-help-2": "Explaining the LFIA technology behind KneeMarker",
          "ai-help-3": "Clinical insights on osteoarthritis progression",
          "ai-help-4": "Guidance on patient management protocols",
          "ai-help-5": "Instruction manual guidance",
          "ai-prompt": "How can I assist you today?",
          "ai-placeholder":
            "Ask about test interpretation, biomarkers, or clinical protocols...",
          "quick-action-1": "CTX-II Significance",
          "quick-action-2": "Sample Collection",
          "quick-action-3": "Invalid Results",
          "positive-interpretation":
            "Two lines detected (T and C lines). This indicates the presence of cartilage degradation biomarkers (CTX-II and/or COMP).",
          "positive-action":
            "Consult with your healthcare provider to discuss the results and potential next steps for managing joint health. Consider baseline radiographic evaluation and follow-up biomarker monitoring.",
          "negative-interpretation":
            "Only the control line (C line) detected. No significant levels of cartilage degradation biomarkers were found.",
          "negative-action":
            "Continue monitoring as recommended by your healthcare provider. For ACL-reconstructed patients, we recommend retesting every 6 months for the first 2 years, then annually.",
          "invalid-interpretation":
            "No control line detected. This may be due to:",
          "invalid-reason-1":
            "Insufficient sample volume (minimum 50μL required)",
          "invalid-reason-2":
            "Expired test kit (check package for expiration date)",
          "invalid-reason-3": "Improper test execution (review instructions)",
          "invalid-action":
            "Repeat the test with a fresh urine sample and new test kit if available. Ensure proper sample application technique.",
          "share-results": "Share Results",
          "download-report": "Download Clinical Report",
          category: "Category",
          range: "Range",
          interpretation: "Interpretation",
          low: "Low",
          moderate: "Moderate",
          high: "High",
          threshold: "Threshold",
          "ctx-low":
            "Normal to mildly elevated levels. Likely no OA or early-stage OA.",
          "ctx-moderate":
            "Moderately elevated. May indicate cartilage breakdown in progress.",
          "ctx-high":
            "Strong indicator of active OA progression or post-traumatic OA.",
          "comp-low": "Within normal variation or mild matrix turnover.",
          "comp-moderate": "Elevated; possible active joint remodeling.",
          "comp-high":
            "Significant matrix degradation, indicative of active OA.",
          "ccp-negative": "Negative, rheumatoid arthritis is unlikely",
          "ccp-positive":
            "Positive, rheumatoid arthritis is likely (98% specificity)",
          "references-title": "Clinical References",
          "ref-1":
            "Kraus VB, et al. (2010). Biomarkers for osteoarthritis: current position and steps towards further validation. Best Pract Res Clin Rheumatol.",
          "ref-2":
            "Whiting PF, et al. (2010). Anti-CCP antibody testing for the diagnosis of rheumatoid arthritis. Cochrane Database Syst Rev.",
          "ref-3":
            "Lohmander LS, et al. (2003). The long-term consequence of anterior cruciate ligament and meniscus injuries: osteoarthritis. Am J Sports Med.",
          "footer-text":
            "© 2025 KneeMarker Diagnostics. All rights reserved. For professional use only.",
          privacy: "Privacy Policy",
          terms: "Terms of Use",
          contact: "Contact Us",
          "manual-title": "KneeMarker Instruction Manual",
          "visual-manual": "Visual Guide",
          "text-manual": "Text Version",
          "manual-purpose": "Purpose of the Test",
          "manual-purpose-text":
            "The KneeMarker is a rapid urine test that detects early signs of osteoarthritis (OA) in patients recovering from ACL injuries by measuring biomarkers of cartilage degradation:",
          "manual-ctx": "CTX-II (C-Telopeptide of type II collagen)",
          "manual-comp": "COMP (Cartilage Oligomeric Matrix Protein)",
          "manual-purpose-note":
            "These markers show cartilage damage before symptoms appear.",
          "manual-contents": "What's Inside the Box",
          "manual-strip": "1× Lateral Flow Test Strip",
          "manual-cup": "1× Urine Collection Cup",
          "manual-dropper": "1× Disposable Dropper",
          "manual-manual": "1× Instruction Manual",
          "manual-qr": "1× QR Code Card (for the KneeMarker App)",
          "manual-gloves": "(Optional) 1× Glove Pair",
          "consult-specialist": "Consult Specialist",
          "consult-note":
            "I can help connect you with a knee specialist or answer any clinical questions you may have about the results.",
          "save-results": "Save Your Results",
          "treatment-notes": "Treatment Notes",
          "next-steps": "Next Steps",
          "save-btn": "Save Results",
          "clear-btn": "Clear",
          "progress-tracker": "Progress Tracker",
          date: "Date",
          notes: "Notes",
          "add-entry": "Add Entry",
          "your-progress": "Your Progress",
          status: "Status",
          actions: "Actions",
          "upload-results": "Upload Previous Results",
        },
        nl: {
          title: "KneeMarker Vroege OA Detectie Systeem",
          subtitle: "Revolutionaire monitoring van post-ACL artrose",
          "about-test": "Over de KneeMarker Test",
          "test-description":
            "De KneeMarker-test is een innovatieve point-of-care laterale stroom immunoassay (LFIA) ontworpen voor vroege detectie van post-traumatische artrose (PTOA) bij ACL-gereconstrueerde patiënten. Onze test meet drie belangrijke biomarkers:",
          "ctx-description":
            "C-telopeptide van type II collageen - een specifieke marker voor kraakbeenafbraak",
          "comp-description":
            "Cartilage Oligomeric Matrix Protein - geeft kraakbeenomzet en structurele integriteit aan",
          "ccp-description":
            "Onderscheidt artrose van reumatoïde artritis met 98% specificiteit",
          "test-details":
            "Deze biomarkers helpen bij het aangeven van kraakbeenafbraak voordat zichtbare symptomen verschijnen. De test is 98% nauwkeurig bij correct gebruik en geeft resultaten in slechts 10 minuten.",
          "how-it-works": "Hoe het Werkt",
          "how-works-1":
            "De test gebruikt goud-nanodeeltje-geconjugeerde antilichamen in een laterale stroom immunoassay-formaat. Wanneer urine wordt aangebracht, binden biomarkers (CTX-II en COMP) aan specifieke antilichamen, waardoor zichtbare complexen ontstaan bij testlijnen. De anti-CCP-strip detecteert afzonderlijk reumatoïde artritis-antilichamen.",
          "how-works-2":
            "Ons eigen algoritme analyseert lijnintensiteit om semi-kwantitatieve resultaten te geven met 98% klinische nauwkeurigheid vergeleken met ELISA-standaarden. De test vereist geen speciale opslag of monsterverwerking.",
          "clinical-significance": "Klinische Betekenis",
          "biomarker-details": "Biomarker Details",
          "early-detection": "Vroege detectie van artrose maakt het mogelijk:",
          therapy: "Tijdige interventie met fysiotherapie",
          lifestyle: "Levensstijlaanpassingen om progressie te vertragen",
          trials:
            "Mogelijke deelname aan klinische onderzoeken voor nieuwe behandelingen",
          surgery: "Betere chirurgische resultaten bij vroegtijdige aanpak",
          "clinical-note":
            "Studies tonen aan dat 50% van de ACL-gereconstrueerde patiënten PTOA ontwikkelen binnen 12-14 jaar. Onze test detecteert biochemische veranderingen jaren vóór radiografisch bewijs.",
          "upload-instructions": "Upload Teststrip voor Analyse",
          "step-1": "Upload Test",
          "step-2": "Analyseren",
          "step-3": "Resultaten",
          intro:
            "Upload een foto van uw teststrip om te beginnen met analyseren.",
          analyze: "Teststrip Analyseren",
          analyzing: "Analyseren...",
          result: "Analyse voltooid! Resultaat: Positief",
          "upload-text": "Sleep uw teststrip afbeelding hierheen",
          "or-text": "of klik om bestanden te bladeren",
          "positive-result":
            "Positief - Biomarkers voor kraakbeenafbraak gedetecteerd",
          "negative-result": "Negatief - Geen biomarkers gedetecteerd",
          "invalid-result": "Ongeldig - Herhaal de test alstublieft",
          "upload-error": "Upload eerst een afbeelding",
          "video-title": "KneeMarker Test Demonstratie",
          "video-description":
            "Zie de test in actie met onze gedetailleerde demonstratievideo",
          "scan-text": "Scan voor meer info",
          "support-text": "Ondersteuning: +31 123 456 789",
          "video-scan-note":
            "Scan de QR-code op uw testkit om toegang te krijgen tot deze video",
          "ai-title": "KneeMarker Klinische Assistent",
          "ai-name": "KneeMarker AI",
          "ai-welcome":
            "Hallo! Ik ben uw KneeMarker klinische assistent. Ik kan helpen met:",
          "ai-help-1": "Interpreteren van testresultaten en biomarker niveaus",
          "ai-help-2": "Uitleg over de LFIA-technologie achter KneeMarker",
          "ai-help-3": "Klinische inzichten in artroseprogressie",
          "ai-help-4": "Begeleiding bij patiëntbeheerprotocollen",
          "ai-help-5": "Instructiehandleiding begeleiding",
          "ai-prompt": "Hoe kan ik u vandaag helpen?",
          "ai-placeholder":
            "Vraag over testinterpretatie, biomarkers of klinische protocollen...",
          "quick-action-1": "CTX-II Betekenis",
          "quick-action-2": "Monsterverzameling",
          "quick-action-3": "Ongeldige Resultaten",
          "positive-interpretation":
            "Twee lijnen gedetecteerd (T- en C-lijnen). Dit duidt op de aanwezigheid van biomarkers voor kraakbeenafbraak (CTX-II en/of COMP).",
          "positive-action":
            "Overleg met uw zorgverlener om de resultaten en mogelijke vervolgstappen voor het beheren van gewrichtsgezondheid te bespreken. Overweeg basislijn radiografische evaluatie en follow-up biomonitoring.",
          "negative-interpretation":
            "Alleen de controlelijn (C-lijn) gedetecteerd. Er werden geen significante niveaus van biomarkers voor kraakbeenafbraak gevonden.",
          "negative-action":
            "Blijf monitoren zoals aanbevolen door uw zorgverlener. Voor ACL-gereconstrueerde patiënten raden we aan elke 6 maanden te testen gedurende de eerste 2 jaar, daarna jaarlijks.",
          "invalid-interpretation":
            "Geen controlelijn gedetecteerd. Dit kan komen door:",
          "invalid-reason-1":
            "Onvoldoende monstervolume (minimaal 50μL vereist)",
          "invalid-reason-2":
            "Verlopen testkit (controleer verpakking op vervaldatum)",
          "invalid-reason-3": "Onjuiste testuitvoering (raadpleeg instructies)",
          "invalid-action":
            "Herhaal de test met een vers urinemonster en nieuwe testkit indien beschikbaar. Zorg voor juiste monstertoepassingstechniek.",
          "share-results": "Resultaten Delen",
          "download-report": "Klinisch Rapport Downloaden",
          category: "Categorie",
          range: "Bereik",
          interpretation: "Interpretatie",
          low: "Laag",
          moderate: "Matig",
          high: "Hoog",
          threshold: "Drempelwaarde",
          "ctx-low":
            "Normale tot licht verhoogde niveaus. Waarschijnlijk geen OA of vroeg stadium OA.",
          "ctx-moderate":
            "Matig verhoogd. Kan wijzen op kraakbeenafbraak in progressie.",
          "ctx-high":
            "Sterke indicator van actieve OA-progressie of post-traumatische OA.",
          "comp-low": "Binnen normale variatie of milde matrixomzet.",
          "comp-moderate": "Verhoogd; mogelijk actieve gewrichtsremodellering.",
          "comp-high":
            "Significante matrixafbraak, indicatief voor actieve OA.",
          "ccp-negative": "Negatief, reumatoïde artritis is onwaarschijnlijk",
          "ccp-positive":
            "Positief, reumatoïde artritis is waarschijnlijk (98% specificiteit)",
          "references-title": "Klinische Referenties",
          "ref-1":
            "Kraus VB, et al. (2010). Biomarkers voor artrose: huidige positie en stappen naar verdere validatie. Best Pract Res Clin Rheumatol.",
          "ref-2":
            "Whiting PF, et al. (2010). Anti-CCP antilichaamtesten voor de diagnose van reumatoïde artritis. Cochrane Database Syst Rev.",
          "ref-3":
            "Lohmander LS, et al. (2003). De langetermijngevolgen van voorste kruisband- en meniscusletsels: artrose. Am J Sports Med.",
          "footer-text":
            "© 2025 KneeMarker Diagnostics. Alle rechten voorbehouden. Voor professioneel gebruik alleen.",
          privacy: "Privacybeleid",
          terms: "Gebruiksvoorwaarden",
          contact: "Contacteer Ons",
          "manual-title": "KneeMarker Instructiehandleiding",
          "visual-manual": "Visuele Gids",
          "text-manual": "Tekstversie",
          "manual-purpose": "Doel van de Test",
          "manual-purpose-text":
            "De KneeMarker is een snelle urinetest die vroege tekenen van artrose (OA) opspoort bij patiënten die herstellen van ACL-verwondingen door biomarkers voor kraakbeenafbraak te meten:",
          "manual-ctx": "CTX-II (C-telopeptide van type II collageen)",
          "manual-comp": "COMP (Cartilage Oligomeric Matrix Protein)",
          "manual-purpose-note":
            "Deze markers tonen kraakbeenschade voordat symptomen verschijnen.",
          "manual-contents": "Wat zit er in de verpakking",
          "manual-strip": "1× Laterale stroom teststrip",
          "manual-cup": "1× Urineopvangbeker",
          "manual-dropper": "1× Wegwerp pipet",
          "manual-manual": "1× Instructiehandleiding",
          "manual-qr": "1× QR-code kaart (voor de KneeMarker App)",
          "manual-gloves": "(Optioneel) 1× paar handschoenen",
          "consult-specialist": "Raadpleeg Specialist",
          "consult-note":
            "Ik kan u helpen een knie-specialist te vinden of klinische vragen over de resultaten beantwoorden.",
          "save-results": "Bewaar Uw Resultaten",
          "treatment-notes": "Behandelnotities",
          "next-steps": "Volgende Stappen",
          "save-btn": "Resultaten Opslaan",
          "clear-btn": "Wissen",
          "progress-tracker": "Voortgangsmonitor",
          date: "Datum",
          notes: "Notities",
          "add-entry": "Toevoegen",
          "your-progress": "Uw Voortgang",
          status: "Status",
          actions: "Acties",
          "upload-results": "Vorige Resultaten Uploaden",
        },
      };

      // Initialize AOS animations
      AOS.init({
        duration: 800,
        easing: "ease-in-out",
        once: true,
      });

      // DOM Elements
      const languageSelector = document.getElementById("languageSelector");
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const analyzeBtn = document.getElementById("analyzeBtn");
      const resultContainer = document.getElementById("resultContainer");
      const aiAssistantBtn = document.getElementById("ai-assistant-btn");
      const aiAssistantContainer = document.getElementById(
        "ai-assistant-container"
      );
      const aiCloseBtn = document.getElementById("ai-close-btn");
      const aiChatBody = document.getElementById("ai-chat-body");
      const aiUserInput = document.getElementById("ai-user-input");
      const aiSendBtn = document.getElementById("ai-send-btn");
      const quickActionBtns = document.querySelectorAll(".quick-action-btn");
      const visualManualBtn = document.getElementById("visualManualBtn");
      const textManualBtn = document.getElementById("textManualBtn");
      const visualManual = document.getElementById("visualManual");
      const textManual = document.getElementById("textManual");
      const saveResultsSection = document.getElementById("saveResultsSection");
      const saveResultsBtn = document.getElementById("saveResultsBtn");
      const clearResultsBtn = document.getElementById("clearResultsBtn");
      const patientNotes = document.getElementById("patientNotes");
      const nextSteps = document.getElementById("nextSteps");
      const addTrackerBtn = document.getElementById("addTrackerBtn");
      const trackerTableBody = document.getElementById("trackerTableBody");
      const trackerDate = document.getElementById("trackerDate");
      const trackerCTX = document.getElementById("trackerCTX");
      const trackerCOMP = document.getElementById("trackerCOMP");
      const trackerNotes = document.getElementById("trackerNotes");
      const aiFileInput = document.getElementById("ai-file-input");
      const aiFileInfo = document.getElementById("ai-file-info");
      const biomarkerChartCanvas = document.createElement("canvas");
      biomarkerChartCanvas.id = "biomarkerChart";
      biomarkerChartCanvas.style.maxHeight = "300px";
      biomarkerChartCanvas.style.margin = "0 auto";

      // Initialize language
      function updateLanguage(lang) {
        // Update all elements with data-lang attribute
        document.querySelectorAll("[data-lang]").forEach((el) => {
          const key = el.getAttribute("data-lang");
          if (translations[lang] && translations[lang][key]) {
            if (el.tagName === "INPUT" && el.type === "text") {
              el.placeholder = translations[lang][key];
            } else {
              el.textContent = translations[lang][key];
            }
          }
        });

        // Update time in initial AI message
        const timeElements = document.querySelectorAll(
          ".assistant-message small"
        );
        timeElements.forEach((el) => {
          el.textContent = translations[lang]["today"] || "Today";
        });
      }

      // Set default language
      languageSelector.value = "en";
      updateLanguage("en");

      languageSelector.addEventListener("change", function () {
        const lang = this.value;
        updateLanguage(lang);
      });

      // Manual toggle functionality
      visualManualBtn.addEventListener("click", function () {
        visualManualBtn.classList.add("active");
        textManualBtn.classList.remove("active");
        visualManual.style.display = "block";
        textManual.style.display = "none";
      });

      textManualBtn.addEventListener("click", function () {
        textManualBtn.classList.add("active");
        visualManualBtn.classList.remove("active");
        textManual.style.display = "block";
        visualManual.style.display = "none";
      });

      // Upload area functionality
      uploadArea.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", function () {
        if (this.files && this.files[0]) {
          const fileName = this.files[0].name;
          const fileUrl = URL.createObjectURL(this.files[0]);

          uploadArea.innerHTML = `
          <button class="clear-upload" onclick="clearUpload()">
            <i class="fas fa-times"></i>
          </button>
          <img src="${fileUrl}" class="img-fluid mb-2" style="max-height: 150px;">
          <h5>${fileName}</h5>
          <p class="text-muted">${
            translations[languageSelector.value]["or-text"]
          }</p>
        `;
        }
      });

      // Clear upload function
      window.clearUpload = function () {
        fileInput.value = "";
        uploadArea.innerHTML = `
        <i class="fas fa-cloud-upload-alt fa-4x mb-3" style="color: var(--primary-color);"></i>
        <h5 data-lang="upload-text">${
          translations[languageSelector.value]["upload-text"]
        }</h5>
        <p class="text-muted" data-lang="or-text">${
          translations[languageSelector.value]["or-text"]
        }</p>
      `;
        updateLanguage(languageSelector.value);
      };

      // Drag and drop functionality
      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        uploadArea.addEventListener(eventName, highlight, false);
      });

      ["dragleave", "drop"].forEach((eventName) => {
        uploadArea.addEventListener(eventName, unhighlight, false);
      });

      function highlight() {
        uploadArea.style.borderColor = "#166088";
        uploadArea.style.backgroundColor = "rgba(22, 96, 136, 0.05)";
      }

      function unhighlight() {
        uploadArea.style.borderColor = "#ddd";
        uploadArea.style.backgroundColor = "#f9fbfd";
      }

      uploadArea.addEventListener("drop", handleDrop, false);

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files;
        fileInput.dispatchEvent(new Event("change"));
      }

      // Load TensorFlow.js model for test strip analysis
      let model;
      async function loadModel() {
        try {
          // In a real application, you would load your trained model here
          // For this example, we'll use a placeholder
          model = await tf.loadLayersModel("path/to/your/model.json");
          console.log("Model loaded successfully");
        } catch (error) {
          console.error("Error loading model:", error);
          // Fallback to traditional analysis if model fails to load
        }
      }

      // Initialize model when page loads
      loadModel();

      // Analysis function with machine learning
      analyzeBtn.addEventListener("click", analyzeTestStrip);

      async function analyzeTestStrip() {
        if (!fileInput.files || !fileInput.files[0]) {
          showAlert(
            translations[languageSelector.value]["upload-error"],
            "danger"
          );
          return;
        }

        const fileUrl = URL.createObjectURL(fileInput.files[0]);
        const lang = languageSelector.value;

        resultContainer.innerHTML = `
        <div class="d-flex justify-content-center align-items-center py-4">
          <div class="spinner-border text-primary me-3" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div>
            <h5 class="mb-1">${translations[lang]["analyzing"]}</h5>
            <p class="text-muted mb-0">${
              translations[lang]["processing-note"] ||
              "Processing test strip image with AI..."
            }</p>
          </div>
        </div>
      `;

        try {
          // Get the uploaded image
          const img = new Image();
          img.src = fileUrl;

          img.onload = async function () {
            // Preprocess the image for the model
            const tensor = preprocessImage(img);

            // Make prediction if model is loaded
            let prediction = null;
            if (model) {
              prediction = await model.predict(tensor).data();
            }

            // Fallback to traditional analysis if no model or prediction fails
            if (!prediction) {
              console.log("Using traditional analysis as fallback");
              prediction = traditionalImageAnalysis(img);
            }

            // Display results
            displayResults(prediction, fileUrl, lang);
          };
        } catch (error) {
          console.error("Analysis error:", error);
          showAlert(
            "Analysis failed. Please try again with a clearer image.",
            "danger"
          );
        }
      }

      // Preprocess image for the model
      function preprocessImage(img) {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 224; // Standard input size for many models
        canvas.height = 224;

        // Draw image to canvas and resize
        ctx.drawImage(img, 0, 0, 224, 224);

        // Convert to tensor and normalize
        return tf.browser
          .fromPixels(canvas)
          .toFloat()
          .div(tf.scalar(255))
          .expandDims();
      }

      // Traditional image analysis (fallback)
      function traditionalImageAnalysis(img) {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0, img.width, img.height);

        // Get image data for analysis
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;

        // Sample some points where we expect the test and control lines to be
        const testLineY = Math.floor(height * 0.4);
        const controlLineY = Math.floor(height * 0.6);
        const sampleWidth = Math.floor(width * 0.8);
        const sampleX = Math.floor(width * 0.1);

        // Check for control line (should always be present in valid tests)
        const controlLinePresent = checkForLine(
          imageData,
          width,
          sampleX,
          controlLineY,
          sampleWidth
        );

        if (!controlLinePresent) {
          return { result: "invalid", confidence: 0.95 };
        }

        // Check for test line
        const testLinePresent = checkForLine(
          imageData,
          width,
          sampleX,
          testLineY,
          sampleWidth
        );

        return {
          result: testLinePresent ? "positive" : "negative",
          confidence: testLinePresent ? 0.89 : 0.92,
        };
      }

      // Helper function to check for a line at a specific y position
      function checkForLine(imageData, width, startX, y, sampleWidth) {
        // Sample points along the expected line position
        const samplePoints = 10;
        let darkPoints = 0;

        for (let i = 0; i < samplePoints; i++) {
          const x = startX + Math.floor((i / samplePoints) * sampleWidth);
          const pixelIndex = (y * width + x) * 4;

          // Simple check for dark pixels (red lines in test strips)
          const r = imageData.data[pixelIndex];
          const g = imageData.data[pixelIndex + 1];
          const b = imageData.data[pixelIndex + 2];

          // Check if pixel is dark (not white/light)
          if (r < 200 && g < 200 && b < 200) {
            darkPoints++;
          }
        }

        // If most sampled points are dark, we consider it a line
        return darkPoints >= samplePoints * 0.7;
      }

      function displayResults(prediction, imageUrl, lang) {
        let resultText, resultClass, interpretation, icon;
        let result = prediction.result || "invalid";
        let confidence = prediction.confidence || 0.85;

        switch (result) {
          case "positive":
            resultText = translations[lang]["positive-result"];
            resultClass = "danger";
            icon = "exclamation-triangle";
            interpretation = `
              <div class="alert alert-light border mb-3">
                <h5><i class="fas fa-info-circle text-primary me-2"></i> ${
                  translations[lang]["positive-interpretation"]
                }</h5>
                <p class="mb-0">${
                  translations[lang]["biomarker-note"] ||
                  "Elevated levels of CTX-II and/or COMP suggest active cartilage degradation."
                }</p>
                <p class="mt-2"><small>AI Confidence: ${(
                  confidence * 100
                ).toFixed(1)}%</small></p>
              </div>
              <div class="alert alert-info">
                <h5><i class="fas fa-clipboard-check text-info me-2"></i> ${
                  translations[lang]["recommended-action"] ||
                  "Recommended Clinical Action"
                }</h5>
                <p>${translations[lang]["positive-action"]}</p>
                <ul class="mb-0">
                  <li>${
                    translations[lang]["action-1"] ||
                    "Consider radiographic evaluation (X-ray/MRI)"
                  }</li>
                  <li>${
                    translations[lang]["action-2"] ||
                    "Implement physical therapy regimen"
                  }</li>
                  <li>${
                    translations[lang]["action-3"] ||
                    "Schedule follow-up biomarker testing in 3 months"
                  }</li>
                </ul>
              </div>
            `;
            break;
          case "negative":
            resultText = translations[lang]["negative-result"];
            resultClass = "success";
            icon = "check-circle";
            interpretation = `
              <div class="alert alert-light border mb-3">
                <h5><i class="fas fa-info-circle text-primary me-2"></i> ${
                  translations[lang]["negative-interpretation"]
                }</h5>
                <p class="mb-0">${
                  translations[lang]["no-biomarker-note"] ||
                  "No significant elevation in cartilage degradation biomarkers detected."
                }</p>
                <p class="mt-2"><small>AI Confidence: ${(
                  confidence * 100
                ).toFixed(1)}%</small></p>
              </div>
              <div class="alert alert-info">
                <h5><i class="fas fa-clipboard-check text-info me-2"></i> ${
                  translations[lang]["recommended-action"] ||
                  "Recommended Clinical Action"
                }</h5>
                <p>${translations[lang]["negative-action"]}</p>
                <ul class="mb-0">
                  <li>${
                    translations[lang]["followup-1"] ||
                    "For ACL patients: retest in 6 months"
                  }</li>
                  <li>${
                    translations[lang]["followup-2"] ||
                    "Monitor for clinical symptoms"
                  }</li>
                  <li>${
                    translations[lang]["followup-3"] ||
                    "Continue preventive measures"
                  }</li>
                </ul>
              </div>
            `;
            break;
          case "invalid":
            resultText = translations[lang]["invalid-result"];
            resultClass = "warning";
            icon = "exclamation-circle";
            interpretation = `
              <div class="alert alert-light border mb-3">
                <h5><i class="fas fa-info-circle text-primary me-2"></i> ${
                  translations[lang]["invalid-interpretation"]
                }</h5>
                <ul>
                  <li>${translations[lang]["invalid-reason-1"]}</li>
                  <li>${translations[lang]["invalid-reason-2"]}</li>
                  <li>${translations[lang]["invalid-reason-3"]}</li>
                </ul>
              </div>
              <div class="alert alert-info">
                <h5><i class="fas fa-clipboard-check text-info me-2"></i> ${
                  translations[lang]["recommended-action"] ||
                  "Recommended Action"
                }</h5>
                <p>${translations[lang]["invalid-action"]}</p>
              </div>
            `;
            break;
        }

        // Create biomarker chart
        const biomarkerChartContainer = document.createElement("div");
        biomarkerChartContainer.className = "mt-4 mb-4";
        biomarkerChartContainer.appendChild(biomarkerChartCanvas);

        // Update chart with biomarker levels
        updateBiomarkerChart(result);

        resultContainer.innerHTML = `
          <div class="test-result slide-up">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4 class="mb-0"><i class="fas fa-${icon} text-${resultClass} me-2"></i> ${resultText}</h4>
              <span class="badge bg-${resultClass}">${result.toUpperCase()}</span>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <img src="${imageUrl}" class="test-result-image w-100" alt="Test strip result">
              </div>
              <div class="col-md-6 text-start">
                <div class="alert alert-${resultClass}">
                  <h5><i class="fas fa-${icon} me-2"></i> ${
          translations[lang]["result-summary"] || "Test Summary"
        }</h5>
                  <p class="mb-2"><strong>CTX-II:</strong> ${getRandomBiomarkerValue(
                    result,
                    "CTX-II"
                  )}</p>
                  <p class="mb-2"><strong>COMP:</strong> ${getRandomBiomarkerValue(
                    result,
                    "COMP"
                  )}</p>
                  <p class="mb-0"><strong>Anti-CCP:</strong> ${getRandomBiomarkerValue(
                    result,
                    "Anti-CCP"
                  )}</p>
                </div>
              </div>
            </div>
            
            ${interpretation}
            
            <!-- Add biomarker chart -->
            <h5 class="mt-4"><i class="fas fa-chart-bar me-2"></i> Biomarker Levels Visualization</h5>
            ${biomarkerChartContainer.outerHTML}
            
            <div class="mt-4">
              <button class="btn btn-primary me-2">
                <i class="fas fa-share-alt me-1"></i> 
                ${translations[lang]["share-results"]}
              </button>
              <button class="btn btn-outline-primary me-2">
                <i class="fas fa-file-pdf me-1"></i> 
                ${translations[lang]["download-report"]}
              </button>
              <button class="btn btn-outline-secondary" id="consultBtn">
                <i class="fas fa-user-md me-1"></i> 
                ${
                  translations[lang]["consult-specialist"] ||
                  "Consult Specialist"
                }
              </button>
            </div>
          </div>
        `;

        // Show save results section
        saveResultsSection.style.display = "block";

        // Add event listener to consult button
        document
          .getElementById("consultBtn")
          ?.addEventListener("click", function () {
            appendMessage(
              "assistant",
              translations[lang]["consult-note"] ||
                "I can help connect you with a knee specialist or answer any clinical questions you may have about the results."
            );
          });
      }

      // Update biomarker chart with test results
      function updateBiomarkerChart(result) {
        const ctx = document.getElementById("biomarkerChart").getContext("2d");

        // Sample data based on test result
        let ctxValue, compValue, ccpValue;
        if (result === "positive") {
          ctxValue = Math.random() * 50 + 20; // Elevated CTX-II
          compValue = Math.random() * 800 + 800; // Elevated COMP
          ccpValue = Math.random() * 3 + 2; // Normal Anti-CCP
        } else if (result === "negative") {
          ctxValue = Math.random() * 10 + 4; // Normal CTX-II
          compValue = Math.random() * 300 + 200; // Normal COMP
          ccpValue = Math.random() * 3 + 2; // Normal Anti-CCP
        } else {
          // Invalid - show zeros
          ctxValue = 0;
          compValue = 0;
          ccpValue = 0;
        }

        // Create chart
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["CTX-II (ng/mmol Cr)", "COMP (ng/mL)", "Anti-CCP (U/mL)"],
            datasets: [
              {
                label: "Biomarker Levels",
                data: [ctxValue, compValue, ccpValue],
                backgroundColor: [
                  "rgba(22, 96, 136, 0.7)",
                  "rgba(79, 195, 247, 0.7)",
                  "rgba(214, 40, 40, 0.7)",
                ],
                borderColor: [
                  "rgba(22, 96, 136, 1)",
                  "rgba(79, 195, 247, 1)",
                  "rgba(214, 40, 40, 1)",
                ],
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Concentration",
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.dataset.label}: ${context.raw.toFixed(
                      2
                    )}`;
                  },
                },
              },
            },
          },
        });
      }

      // Helper function to generate realistic biomarker values based on result
      function getRandomBiomarkerValue(result, biomarker) {
        if (biomarker === "Anti-CCP") {
          return result === "positive"
            ? "7.2 U/mL (Positive)"
            : "2.1 U/mL (Negative)";
        }

        if (biomarker === "CTX-II") {
          if (result === "positive") {
            const value = (Math.random() * 50 + 20).toFixed(1);
            return `${value} ng/mmol Cr (Elevated)`;
          } else {
            const value = (Math.random() * 10 + 4).toFixed(1);
            return `${value} ng/mmol Cr (Normal)`;
          }
        }

        if (biomarker === "COMP") {
          if (result === "positive") {
            const value = Math.floor(Math.random() * 800 + 800);
            return `${value} ng/mL (Elevated)`;
          } else {
            const value = Math.floor(Math.random() * 300 + 200);
            return `${value} ng/mL (Normal)`;
          }
        }

        return "N/A";
      }

      function showAlert(message, type) {
        resultContainer.innerHTML = `
        <div class="alert alert-${type}">
          <i class="fas fa-${
            type === "danger" ? "exclamation-triangle" : "info-circle"
          } me-2"></i>
          ${message}
        </div>
      `;
      }

      // AI Assistant Chat Functionality
      function toggleChat() {
        const isVisible = aiAssistantContainer.style.display === "flex";
        aiAssistantContainer.style.display = isVisible ? "none" : "flex";
        if (!isVisible) {
          aiUserInput.focus();
        }
      }

      // Make AI assistant draggable
      let isDragging = false;
      let offsetX, offsetY;

      aiAssistantContainer.addEventListener("mousedown", (e) => {
        if (e.target.closest(".ai-chat-header")) {
          isDragging = true;
          offsetX =
            e.clientX - aiAssistantContainer.getBoundingClientRect().left;
          offsetY =
            e.clientY - aiAssistantContainer.getBoundingClientRect().top;
          aiAssistantContainer.style.cursor = "grabbing";
        }
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;

        const x = e.clientX - offsetX;
        const y = e.clientY - offsetY;

        // Keep within viewport bounds
        const maxX = window.innerWidth - aiAssistantContainer.offsetWidth;
        const maxY = window.innerHeight - aiAssistantContainer.offsetHeight;

        aiAssistantContainer.style.left = `${Math.min(Math.max(0, x), maxX)}px`;
        aiAssistantContainer.style.top = `${Math.min(Math.max(0, y), maxY)}px`;
        aiAssistantContainer.style.right = "auto";
        aiAssistantContainer.style.bottom = "auto";
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
        aiAssistantContainer.style.cursor = "move";
      });

      // Set up event listeners for AI chat
      aiAssistantBtn.addEventListener("click", toggleChat);
      aiCloseBtn.addEventListener("click", toggleChat);

      // Quick action buttons
      quickActionBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          const question = this.getAttribute("data-question");
          aiUserInput.value = question;
          aiSendBtn.click();
        });
      });

      // File upload in AI chat
      aiFileInput.addEventListener("change", function () {
        if (this.files && this.files[0]) {
          aiFileInfo.textContent = this.files[0].name;

          // Simulate analysis of uploaded results
          setTimeout(() => {
            appendMessage(
              "assistant",
              "I've analyzed your previous test results. Based on the data, I can see your CTX-II levels have been trending downward over the past 3 months, which is a positive sign. Would you like me to compare these with your current results?"
            );
          }, 1500);
        }
      });

      // Save results functionality
      saveResultsBtn.addEventListener("click", function () {
        const notes = patientNotes.value;
        const steps = nextSteps.value;

        if (!notes && !steps) {
          showAlert(
            "Please add some notes or next steps before saving.",
            "warning"
          );
          return;
        }

        // In a real app, you would save to a database or local storage
        showAlert("Results saved successfully!", "success");

        // Clear the fields
        patientNotes.value = "";
        nextSteps.value = "";
      });

      clearResultsBtn.addEventListener("click", function () {
        patientNotes.value = "";
        nextSteps.value = "";
      });

      // Progress tracker functionality
      addTrackerBtn.addEventListener("click", function () {
        const date = trackerDate.value;
        const ctx = trackerCTX.value;
        const comp = trackerCOMP.value;
        const notes = trackerNotes.value;

        if (!date || (!ctx && !comp)) {
          showAlert(
            "Please enter at least a date and one biomarker value.",
            "warning"
          );
          return;
        }

        // Determine status based on values
        let status = "Normal";
        if (ctx > 63 || comp > 1400) {
          status = "High Risk";
        } else if (ctx > 15 || comp > 600) {
          status = "Moderate Risk";
        }

        // Add to table
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
          <td>${date}</td>
          <td>${ctx || "-"}</td>
          <td>${comp || "-"}</td>
          <td><span class="badge ${
            status === "High Risk"
              ? "bg-danger"
              : status === "Moderate Risk"
              ? "bg-warning"
              : "bg-success"
          }">${status}</span></td>
          <td><button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash-alt"></i></button></td>
        `;

        trackerTableBody.appendChild(newRow);

        // Add event listener to delete button
        newRow.querySelector("button").addEventListener("click", function () {
          newRow.remove();
          updateTrackerGraph();
        });

        // Clear form
        trackerDate.value = "";
        trackerCTX.value = "";
        trackerCOMP.value = "";
        trackerNotes.value = "";

        // Update graph
        updateTrackerGraph();
      });

      // Update tracker graph
      function updateTrackerGraph() {
        const rows = trackerTableBody.querySelectorAll("tr");
        const graph = document.querySelector(".tracker-graph");

        // Clear existing points
        document
          .querySelectorAll(".graph-point, .graph-label")
          .forEach((el) => el.remove());

        if (rows.length === 0) return;

        // Get all dates and values
        const dates = [];
        const ctxValues = [];
        const compValues = [];

        rows.forEach((row) => {
          const cells = row.querySelectorAll("td");
          dates.push(cells[0].textContent);
          ctxValues.push(parseFloat(cells[1].textContent) || 0);
          compValues.push(parseFloat(cells[2].textContent) || 0);
        });

        // Calculate positions for graph points
        const maxValue = Math.max(...ctxValues, ...compValues) * 1.2;
        const graphWidth = graph.offsetWidth - 100; // accounting for margins
        const graphHeight = 150; // height available for points

        // Add points to graph
        dates.forEach((date, index) => {
          const xPos = 50 + index * (graphWidth / (dates.length - 1));

          // CTX-II point
          if (ctxValues[index] > 0) {
            const yPos = 200 - (ctxValues[index] / maxValue) * graphHeight;
            const point = document.createElement("div");
            point.className = "graph-point";
            point.style.left = `${xPos}px`;
            point.style.top = `${yPos}px`;
            point.style.background = "var(--primary-color)";
            graph.appendChild(point);
          }

          // COMP point
          if (compValues[index] > 0) {
            const yPos = 200 - (compValues[index] / maxValue) * graphHeight;
            const point = document.createElement("div");
            point.className = "graph-point";
            point.style.left = `${xPos}px`;
            point.style.top = `${yPos}px`;
            point.style.background = "var(--accent-color)";
            graph.appendChild(point);
          }

          // Date label
          if (index === 0 || index === dates.length - 1) {
            const label = document.createElement("div");
            label.className = "graph-label";
            label.textContent = date;
            label.style.left = `${xPos - 25}px`;
            label.style.top = "210px";
            graph.appendChild(label);
          }
        });
      }

      // Send message function
      aiSendBtn.addEventListener("click", sendMessage);
      aiUserInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          sendMessage();
        }
      });

      async function sendMessage() {
        const userMessage = aiUserInput.value.trim();
        if (!userMessage) return;

        // Add user message to chat
        appendMessage("user", userMessage);
        aiUserInput.value = "";

        // Show thinking indicator
        const thinkingElement = appendMessage(
          "assistant",
          translations[languageSelector.value]["thinking"] || "Thinking",
          true
        );

        try {
          // Enhanced AI prompt with language awareness
          const lang = languageSelector.value;
          const prompt = `You are KneeMarker AI, an advanced clinical assistant specialized in osteoarthritis biomarkers and post-ACL rehabilitation. You are speaking to a medical professional (doctor/surgeon). 
          
          Current language: ${
            lang === "nl" ? "Respond in Dutch" : "Respond in English"
          }
          
          Provide accurate, evidence-based information about:
          1. Interpretation of KneeMarker LFIA test results (CTX-II, COMP, Anti-CCP)
          2. Clinical significance of biomarker levels in PTOA progression
          3. Comparison with traditional diagnostic methods (X-ray, MRI)
          4. Recommended monitoring protocols for ACL-reconstructed patients
          5. Differential diagnosis between OA and RA using Anti-CCP
          6. Instruction manual guidance (sample collection, test procedure)
          7. Analysis of historical test results to track progress
          
          Be professional yet concise. Cite studies when appropriate (Kraus et al., Lohmander et al.). For complex cases, recommend specialist consultation. 
          
          Current question: ${userMessage}`;

          const apiUrl = `https://api.shecodes.io/ai/v1/generate?prompt=${encodeURIComponent(
            prompt
          )}&key=${apiKey}`;
          const response = await fetch(apiUrl);
          const data = await response.json();

          const text =
            data.answer ||
            (lang === "nl"
              ? "Sorry, ik kon uw verzoek niet verwerken. Probeer het alstublieft opnieuw."
              : "Sorry, I couldn't process your request. Please try again.");

          // Remove thinking indicator and add real response
          aiChatBody.removeChild(thinkingElement);
          appendMessage("assistant", formatAIResponse(text));
        } catch (error) {
          console.error("Error:", error);
          aiChatBody.removeChild(thinkingElement);
          const errorMessage =
            translations[languageSelector.value]["connection-error"] ||
            "Sorry, I'm having trouble connecting. Please try again later.";
          appendMessage("assistant", errorMessage);
        }
      }

      // Format AI response with better readability
      function formatAIResponse(text) {
        // Add bullet points for lists
        text = text.replace(/\n\s*\d+\./g, "\n•");

        // Highlight key terms
        const keywords = [
          "CTX-II",
          "COMP",
          "Anti-CCP",
          "PTOA",
          "ACL",
          "osteoarthritis",
          "rheumatoid arthritis",
          "artrose",
          "reumatoïde artritis",
        ];
        keywords.forEach((word) => {
          const regex = new RegExp(`\\b${word}\\b`, "gi");
          text = text.replace(regex, `<strong>${word}</strong>`);
        });

        // Add paragraph breaks
        text = text.replace(/\n\n/g, "</p><p>");

        return `<p>${text}</p>`;
      }

      function appendMessage(role, text, isThinking = false) {
        const messageElement = document.createElement("div");

        if (isThinking) {
          messageElement.className = "thinking-message";
          messageElement.innerHTML = `
            ${text} 
            <div class="thinking-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          `;
        } else {
          messageElement.className = `message ${role}-message`;
          messageElement.innerHTML = `
            <div class="d-flex align-items-center mb-1">
              <strong>${
                role === "user"
                  ? translations[languageSelector.value]["you"] || "You"
                  : translations[languageSelector.value]["ai-name"]
              }</strong>
              <small class="text-muted ms-2">${new Date().toLocaleTimeString(
                [],
                {
                  hour: "2-digit",
                  minute: "2-digit",
                }
              )}</small>
            </div>
            <div>${text}</div>
          `;
        }

        aiChatBody.appendChild(messageElement);
        aiChatBody.scrollTop = aiChatBody.scrollHeight;

        return messageElement;
      }
    </script>
  </body>
</html>
